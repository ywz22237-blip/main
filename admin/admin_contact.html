<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact ê´€ë¦¬ - Admin</title>
    <link rel="stylesheet" href="admin_style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="admin-wrapper">
        <aside class="sidebar">
            <div class="sidebar-header"><h2>ADMIN</h2></div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="index_admin.html">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a></li>
                    <li><a href="admin_about.html">â„¹ï¸ About ê´€ë¦¬</a></li>
                    <li><a href="admin_service.html">ğŸ›  Service ê´€ë¦¬</a></li>
                    <li><a href="admin_news.html">ğŸ“° News ê´€ë¦¬</a></li>
                    <li><a href="admin_contact.html" class="active">ğŸ“ Contact ê´€ë¦¬</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer"><a href="../index.html" class="btn-exit">ğŸ  ì‚¬ì´íŠ¸ ë‚˜ê°€ê¸°</a></div>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <h1>Contact ê´€ë¦¬ (ë¬¸ì˜ ë‚´ì—­)</h1>
                <div class="user-info">ê³ ê°ì´ ë‚¨ê¸´ ë¬¸ì˜ ì‚¬í•­ì„ í™•ì¸í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.</div>
            </header>

            <section class="admin-card-section">
                <div class="section-title">ğŸ“¬ ë°›ì€ ë¬¸ì˜ ëª©ë¡</div>
                <div class="table-container">
                    <table class="partner-table">
                        <thead>
                            <tr>
                                <th style="width: 130px;">ë‚ ì§œ/ì‹œê°„</th>
                                <th style="width: 150px;">ì´ë¦„/ì—°ë½ì²˜</th>
                                <th style="width: 200px;">ì œëª©</th>
                                <th>ë¬¸ì˜ ë‚´ìš©</th>
                                <th style="width: 80px;">ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="contactTableBody">
                            <tr><td colspan="5" style="text-align:center;">ë¬¸ì˜ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <script>
        const SUPABASE_URL = 'https://vhmihojfcokhkoxpejuj.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZobWlob2pmY29raGtveHBlanVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0Njg1OTMsImV4cCI6MjA4NDA0NDU5M30.k5O_GS11jn-FJ4XU1aR2PgpSplBAe984WsSxEp4oshg';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // ë¬¸ì˜ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadContacts() {
            const { data, error } = await _supabase
                .from('contact_table')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                console.error(error);
                return;
            }

            const tbody = document.getElementById('contactTableBody');
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">ë„ì°©í•œ ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            tbody.innerHTML = data.map(c => {
                // ë‚ ì§œ ì •ë³´ ì²˜ë¦¬
                let dateDisplay = "ë‚ ì§œ ì—†ìŒ";
                let timeDisplay = "";

                if (c.created_at) {
                    const date = new Date(c.created_at);
                    if (!isNaN(date.getTime())) {
                        // ì²« ë²ˆì§¸ ì¤„: ì—°.ì›”.ì¼
                        dateDisplay = date.toLocaleDateString('ko-KR', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit'
                        });
                        // ë‘ ë²ˆì§¸ ì¤„: ì˜¤ì „/ì˜¤í›„ ì‹œ:ë¶„
                        timeDisplay = date.toLocaleTimeString('ko-KR', {
                            hour: '2-digit',
                            minute: '2-digit',
                            hour12: true
                        });
                    }
                }

                return `
                    <tr>
                        <td style="text-align: center; line-height: 1.5;">
                            <div style="font-size: 0.9rem; font-weight: 600; color: #333;">${dateDisplay}</div>
                            <div style="font-size: 0.75rem; color: #888;">${timeDisplay}</div>
                        </td>
                        <td>
                            <strong>${c.name}</strong><br>
                            <small style="color: #4299e1;">${c.phone}</small><br>
                            <small style="color: #888;">${c.email}</small>
                        </td>
                        <td style="font-weight: 600;">${c.subject}</td>
                        <td>
                            <div style="max-width: 400px; white-space: pre-wrap; font-size: 0.9rem; color: #444; line-height: 1.4;">${c.message}</div>
                        </td>
                        <td>
                            <button onclick="deleteContact(${c.id})" style="background:#e53e3e; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">ì‚­ì œ</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ë¬¸ì˜ ì‚­ì œí•˜ê¸°
        async function deleteContact(id) {
            if (!confirm("ì´ ë¬¸ì˜ ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            const { error } = await _supabase.from('contact_table').delete().eq('id', id);
            if (error) alert("ì‚­ì œ ì‹¤íŒ¨");
            else loadContacts();
        }

        window.onload = loadContacts;
    </script>
</body>
</html>