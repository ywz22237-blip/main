<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About ê´€ë¦¬ - Admin</title>
    <link rel="stylesheet" href="admin_style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="admin-wrapper">
        <aside class="sidebar">
            <div class="sidebar-header"><h2>ADMIN</h2></div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="index_admin.html">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a></li>
                    <li><a href="admin_about.html" class="active">â„¹ï¸ About ê´€ë¦¬</a></li>
                    <li><a href="admin_service.html">ğŸ›  Service ê´€ë¦¬</a></li>
                    <li><a href="admin_news.html">ğŸ“° News ê´€ë¦¬</a></li>
                    <li><a href="admin_contact.html">ğŸ“ Contact ê´€ë¦¬</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer"><a href="../index.html" class="btn-exit">ğŸ  ì‚¬ì´íŠ¸ ë‚˜ê°€ê¸°</a></div>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <h1>About ê´€ë¦¬ (íŒŒíŠ¸ë„ˆì‚¬)</h1>
                <div class="user-info">í˜‘ë ¥ì‚¬ ë¡œê³ ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. (ë“±ë¡ì¼ì€ DBì— ìë™ ì €ì¥ë©ë‹ˆë‹¤)</div>
            </header>

            <section class="admin-card-section">
                <div class="section-title">â• ìƒˆ íŒŒíŠ¸ë„ˆì‚¬ ë“±ë¡</div>
                <form id="partnerForm" style="display: flex; gap: 15px; align-items: flex-end; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <div class="input-group" style="flex: 1; margin-bottom: 0;">
                        <label>íŒŒíŠ¸ë„ˆì‚¬ ëª…</label>
                        <input type="text" id="partnerName" placeholder="íšŒì‚¬ëª… ì…ë ¥" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="input-group" style="flex: 1; margin-bottom: 0;">
                        <label>ë¡œê³  ì´ë¯¸ì§€ (ê°€ë¡œí˜• ê¶Œì¥)</label>
                        <input type="file" id="partnerFile" accept="image/*" required style="width: 100%; padding: 8px; background: white; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <button type="submit" id="saveBtn" style="padding: 12px 25px; background: #4299e1; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">ë“±ë¡í•˜ê¸°</button>
                </form>
            </section>

            <section class="admin-card-section">
                <div class="section-title">ğŸ¤ íŒŒíŠ¸ë„ˆì‚¬ ëª©ë¡</div>
                <div class="table-container">
                    <table class="partner-table">
                        <thead>
                            <tr>
                                <th>ë¡œê³ </th>
                                <th>íŒŒíŠ¸ë„ˆì‚¬ ëª…</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="partnerTableBody">
                            <tr><td colspan="3" style="text-align:center;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <script>
        const SUPABASE_URL = 'https://vhmihojfcokhkoxpejuj.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZobWlob2pmY29raGtveHBlanVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0Njg1OTMsImV4cCI6MjA4NDA0NDU5M30.k5O_GS11jn-FJ4XU1aR2PgpSplBAe984WsSxEp4oshg';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // 1. ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadPartners() {
            const { data, error } = await _supabase.from('about_table').select('*').order('created_at', { ascending: false });
            if (error) return console.error(error);

            const tbody = document.getElementById('partnerTableBody');
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;">ë“±ë¡ëœ íŒŒíŠ¸ë„ˆì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            tbody.innerHTML = data.map(p => `
                <tr>
                    <td><img src="${p.logo_url}" style="height:40px; width:auto; max-width:120px; object-fit:contain;"></td>
                    <td><strong>${p.name}</strong></td>
                    <td><button onclick="deletePartner(${p.id})" style="background:#e53e3e; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">ì‚­ì œ</button></td>
                </tr>
            `).join('');
        }

        // 2. ë“±ë¡í•˜ê¸°
        document.getElementById('partnerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const saveBtn = document.getElementById('saveBtn');
            const file = document.getElementById('partnerFile').files[0];
            const name = document.getElementById('partnerName').value;

            saveBtn.innerText = "ì—…ë¡œë“œ ì¤‘...";
            saveBtn.disabled = true;

            try {
                const fileName = `${Date.now()}_${file.name}`;
                const { data: upData, error: upError } = await _supabase.storage.from('about_logos').upload(fileName, file);
                if (upError) throw upError;

                const { data: urlData } = _supabase.storage.from('about_logos').getPublicUrl(fileName);
                const logo_url = urlData.publicUrl;

                // DB ì €ì¥ (created_atì€ DB ì„¤ì •ì— ì˜í•´ ìë™ìœ¼ë¡œ ë“¤ì–´ê°)
                const { error: dbError } = await _supabase.from('about_table').insert([{ name, logo_url }]);
                if (dbError) throw dbError;

                alert("ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
                location.reload();
            } catch (err) {
                alert("ì‹¤íŒ¨: " + err.message);
                saveBtn.innerText = "ë“±ë¡í•˜ê¸°";
                saveBtn.disabled = false;
            }
        });

        // 3. ì‚­ì œí•˜ê¸°
        async function deletePartner(id) {
            if (!confirm("í•´ë‹¹ íŒŒíŠ¸ë„ˆì‚¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            const { error } = await _supabase.from('about_table').delete().eq('id', id);
            if (error) alert("ì‚­ì œ ì‹¤íŒ¨");
            else loadPartners();
        }

        window.onload = loadPartners;
    </script>
</body>
</html>